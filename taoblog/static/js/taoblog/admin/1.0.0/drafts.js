(function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};define("taoblog/admin/1.0.0/drafts",["$","./toolbar","./dom","./browser","./utils"],function(t){var n,r,o,i,s,u,a,l;return n=t("$"),i=t("./toolbar"),r=t("./browser"),s=t("./utils"),u=t("./dom"),o=function(t){function r(){return l=r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.showDate=function(){var t;return t=new Date,n(this.items).find("TD.draft-date > time").each(function(){var t;return t=new Date(n(this).attr("datetime")),n(this).text(s.getTimeAgo(t))})},r.prototype.makeDraftItem=function(t){return u(["tr",{"class":"item","data-id":t.id},["td",{"class":"draft-title"},s.truncate(t.title,64)],["td",{"class":"draft-text"},s.truncate(t.text,64)],["td",{"class":"draft-date"},["time",{datetime:t.saved_at+"Z"},s.getTimeAgo(t.saved_at)]]])},r.prototype.setDrafts=function(t){var e,n,r;for(this.tbody.empty(),n=0,r=t.length;r>n;n++)e=t[n],this.tbody.append(this.makeDraftItem(e));return this.reload()},r.prototype.appenddrafts=function(t){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],this.tbody.append(this.makeDraftItem(e));return this.reload()},r.prototype.removeSelections=function(t){var e,r,o;return o=0,r=this.getSelections().length,e=this,this.getSelections().fadeOut("fast",function(){return n(this).remove(),o++,o>=r?(e.reload(),"function"==typeof t?t():void 0):void 0})},r}(r),a=function(){var t,e,r;return t=new o("TABLE.browser"),r=new i("#toolbar"),t.bind("dblclick",function(){return window.location="/draft/"+n(this).data("id")+"/edit"}),t.bind("click",function(){return e()}),e=function(){return r.hideAllMenus(),r.showMenu("new-post"),t.getSelections().length>0?r.showMenu("delete-draft"):r.hideMenu("delete-draft")},n("html").click(function(o){return 0===t.items.find(o.target).length&&0===n(r.selector).find(o.target).length?(t.clearSelections(),e()):void 0}),function(t){var e;return e=r.addMenu("new-post",["li",["a",{href:"/admin/compose"},"New Post"]]),e=r.addMenu("delete-draft",["li",["a",{href:"#"},"Delete"]]),r.hideMenu("delete-draft"),n("a",e).click(function(e){var r;return e.preventDefault(),n.ajax({url:"/api/drafts/?bulk="+encodeURIComponent(function(){var e,o,i,s;for(i=t.getSelections(),s=[],e=0,o=i.length;o>e;e++)r=i[e],s.push(n(r).data("id"));return s}().join(",")),type:"DELETE",dataType:"json",success:function(){var e;return e=t.getSelections().length,t.removeSelections(function(){return s.flash(""+e+" "+(1===e?"draft":"drafts")+" has been deleted")})},error:function(){return s.flash("failed to delete selected drafts","error")}})}),t.showDate()}(t)}})}).call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("taoblog/admin/1.0.0/toolbar",["$","./dom"],function(e){var n,r,o;return n=e("$"),o=e("./dom"),r=function(){function e(e){this.addMenu=t(this.addMenu,this),this.selector=e,this.menus={}}return e.prototype.addMenu=function(t,e){var r;return t in this.menus?r=this.menus[t]:(r=o(e),this.menus[t]=r,n(this.selector).append(r)),r},e.prototype.removeAll=function(){return n(this.selector).remove()},e.prototype.removeMenu=function(t){return n(this.menus[t]).remove(),delete this.menus[t]},e.prototype.hideMenu=function(t){return n(this.menus[t]).hide()},e.prototype.showMenu=function(t){return n(this.menus[t]).show()},e.prototype.hideAllMenus=function(){var t,e,r,o;r=this.menus,o=[];for(t in r)e=r[t],o.push(n(e).hide());return o},e.prototype.showAllMenus=function(){var t,e,r,o;r=this.menus,o=[];for(t in r)e=r[t],o.push(n(e).show());return o},e.prototype.empty=function(){return n(this.selector).empty(),this.menus={}},e}()})}.call(this),function(){define("taoblog/admin/1.0.0/dom",[],function(){var t;return t=function(e){var n,r,o,i,s,u,a,l;if(0===e.length)return null;for(r=e[0]instanceof HTMLElement?e[0]:document.createElement(e[0]),l=e.slice(1),u=0,a=l.length;a>u;u++)if(i=l[u],"[object String]"===toString.call(i))r.appendChild(document.createTextNode(i));else if(i instanceof Text)r.appendChild(i);else if(Array.isArray(i))n=t(i),null!=n&&r.appendChild(n);else if(i instanceof Attr)r.setAttributeNode(i);else if(i===Object(i))for(o in i)s=i[o],r.setAttribute(o,s);return r}})}.call(this),function(){define("taoblog/admin/1.0.0/browser",["$"],function(t){var e,n;return e=t("$"),n=function(){function t(t){var n;n=this,this.selectedClass="selected",this.tbody=e(t).children("TBODY"),this.items=this.tbody.children("TR.item"),this.lastSelectedRow=0,this.selector=t,this.events=[],this.bind("click",function(t,e){var r,o,i;if(t.shiftKey)for(r=o=e,i=n.lastSelectedRow;i>=e?i>=o:o>=i;r=i>=e?++o:--o)n.select(r);else t.ctrlKey?n.toggleSelection(e):(n.clearSelections(),n.select(e));return n.lastSelectedRow=e})}return t.prototype.select=function(t){return this.isSelected(t)?void 0:this.items.eq(t).addClass(this.selectedClass)},t.prototype.unselect=function(t){return this.isSelected(t)?this.items.eq(t).removeClass(this.selectedClass):void 0},t.prototype.clearSelections=function(){var t,e,n,r;for(r=[],t=e=0,n=this.items.length;n>=0?n>=e:e>=n;t=n>=0?++e:--e)r.push(this.unselect(t));return r},t.prototype.isSelected=function(t){return this.items.eq(t).hasClass(this.selectedClass)},t.prototype.toggleSelection=function(t){return this.isSelected(t)?this.unselect(t):this.select(t)},t.prototype.getSelections=function(){return this.items.filter("."+this.selectedClass)},t.prototype.selectAll=function(){return this.items.addClass(selectedClass)},t.prototype.bind=function(t,n){return this.events.push({type:t,handler:n}),this.items.each(function(r){return e(this).bind(t,function(t){return n.apply(this,[t,r])})})},t.prototype.rebind=function(){var t,e,n,r,o;for(e=this.events,this.events=[],o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(this.bind(t.type,t.handler));return o},t.prototype.reload=function(){return this.items=this.tbody.children("TR.item"),this.lastSelectedRow=0,this.items.unbind(),this.rebind()},t}()})}.call(this),function(){define("taoblog/admin/1.0.0/utils",["$","./dom"],function(t){var e,n,r,o,i;return e=t("$"),n=t("./dom"),o=function(t){var e,n,r,o,i;return o=new Date,i=Math.floor((o-t)/1e3),0===i?"just now":(r=Math.floor(i/60),0===r?""+i+" "+(1===i?"second":"seconds")+" ago":(n=Math.floor(r/60),0===n?""+r+" "+(1===r?"minute":"minutes")+" ago":(e=Math.floor(n/24),0===e?""+n+" "+(1===n?"hour":"hours")+" ago":e>30?t.toDateString():""+e+" "+(1===e?"day":"days")+" ago")))},i=function(t,e,n,r){var o,i,s,u,a;if(null==e&&(e=255),null==n&&(n=!1),null==r&&(r="..."),console.log(t),e>=t.length)return t;if(n)return t.slice(0,+(e-1)+1||9e9)+r;for(o=s=e,u=e/2;u>=e?u>=s:s>=u;o=u>=e?++s:--s)if("\n"===(a=t[o])||"	"===a||" "===a)i=!0;else if(i)return t.slice(0,+(o-1)+1||9e9)+r;return t.slice(0,+(o-1)+1||9e9)+r},r=function(t,r){var o;return null==r&&(r="success"),o=n(["p",{"class":r},t]),e("#flash").append(o),e(o).hide(),e(o).fadeIn("fast").delay("success"===r?3e3:6e3).fadeOut("slow",function(){return e(this).remove()})},{getTimeAgo:o,truncate:i,flash:r}})}.call(this);
