// Generated by CoffeeScript 1.6.2
(function() {
  define(function(require, exports, module) {
    var $, Toolbar, ace, setupCompose;

    $ = require('$');
    Toolbar = require('./toolbar');
    ace = require('ace');
    return setupCompose = function() {
      var editor, text, title;

      title = $('div.post-editor input[name="title"]');
      text = $('div.post-editor textarea[name="text"]');
      editor = ace.edit('editor');
      editor.setTheme("ace/theme/solarized_light");
      editor.getSession().setMode("ace/mode/markdown");
      editor.setValue(text.val());
      $('#save-draft').click(function(event) {
        var editorText, normalColor;

        event.preventDefault();
        editorText = editor.getValue();
        if (!title.val() && !editorText) {
          normalColor = title.css('border-color');
          title.select();
          title.css({
            'border-color': 'red'
          });
          return title.one('keydown', function() {
            return title.css('border-color', normalColor);
          });
        } else {
          text.text(editorText);
          $('#compose-form').attr({
            action: $(this).data('action'),
            method: 'POST'
          });
          return $('#compose-form').submit();
        }
      });
      return $('#new-post').click(function(event) {
        var editorText, normalColor, titleVal;

        event.preventDefault();
        title = $('div.post-editor > input.title');
        titleVal = $.trim(title.val());
        editorText = editor.getValue();
        if (titleVal) {
          text.text(editorText);
          $('#compose-form').attr({
            action: $(this).data('action'),
            method: 'POST'
          });
          return $('#compose-form').submit();
        } else {
          normalColor = title.css('border-color');
          title.css('border-color', 'red');
          title.select();
          return title.one('keydown', function() {
            return title.css({
              'border-color': normalColor
            });
          });
        }
      });
    };
  });

}).call(this);
